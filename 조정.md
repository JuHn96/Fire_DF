# 🔥 CCTV 화재 감지 프로젝트 전체 기술 정리 + 역할 분담 (균형 조정 버전)

📌 **팀 공유용 · 기술/역할 정리 문서 (업무량 균형 조정 버전)**  
AI 쪽에서 데이터 수집·라벨링·학습까지 담당하는 것을 고려해서 BE/DB 업무량을 보강한 최종 정리본입니다.

---

## 📚 목차

1. [프로젝트 전체 흐름 구조](#1-프로젝트-전체-흐름-구조)
2. [실시간 영상(WebSocket) 스트리밍 구조](#2-실시간-영상websocket-스트리밍-구조)
3. [화재 이벤트 처리 흐름](#3-화재-이벤트-처리-흐름)
4. [정규화 / N:M 관계 / 2NF 요약](#4-정규화--nm-관계--2nf-요약)
5. [비밀번호 해싱(Argon2) 요약](#5-비밀번호-해싱argon2-요약)
6. [역할별 + FE 분담 상세 정리 (균형 조정 버전)](#6-역할별--fe-분담-상세-정리-균형-조정-버전)
7. [FE 분담 최종 표](#7-fe-분담-최종-표)

---

## 1. 프로젝트 전체 흐름 구조

### 🔧 시스템 아키텍처 개요

```text
[IP CCTV / 웹캠]
        ↓ (RTSP / 장치)
[Python AI 서버]  ← AI 담당 (+ 모델/추론)
 - OpenCV 캡처
 - 화재 감지 모델 적용
 - 감지 박스 그리기
 - 감지 결과/메타데이터 생성

        ↓ (WebSocket / BE)
[백엔드 API & WebSocket 서버]  ← BE 담당 (+ FE 대시보드/로그/알림/실시간 레이아웃)
 - WebSocket으로 프레임/메타데이터 송출
 - 화재 시 이벤트 REST 수신
 - DB 저장
 - 로그/통계 API 제공

        ↓ (SQL)
[DB(MySQL)]        ← DB 담당 (+ FE 설정/관리/관리자 대시보드 일부)
 - cameras
 - fire_events
 - users / roles
 - 기타 설정/권한 관련 테이블

        ↑
        └────[프론트엔드(Vue)]────┘  ← FE는 3명 분담
```

> AI는 **모델/추론** 중심, BE는 **WebSocket·API·대시보드**, DB는 **스키마·관리/권한·관리자 통계** 중심으로 역할을 나누는 구조.

---

## 2. 실시간 영상(WebSocket) 스트리밍 구조

### ✔ 전체 개요

- Python AI 모듈  
  → RTSP/웹캠에서 영상 캡처 + 화재 감지  
- BE WebSocket 서버  
  → 프레임/메타데이터를 브라우저로 실시간 송출  
- 브라우저(Vue)  
  → `<img>`에 바인딩해서 실시간 CCTV 화면 표시  

### 🧩 Python(모델 + 프레임 처리 모듈)

```python
import cv2, asyncio, aiohttp

RTSP_URL = "rtsp://user:pass@192.168.0.50:554/stream"

async def detect_and_pack():
    cap = cv2.VideoCapture(RTSP_URL)
    while True:
        ret, frame = cap.read()
        if not ret:
            continue

        # AI 감지 (생략) + 박스 좌표/라벨/score 생성
        # results, fire_detected, meta = detect_fire(frame)

        yield frame  # 또는 (frame, meta)
```

### 🖥 BE(WebSocket 서버, 실시간 전송 담당)

```python
import asyncio, websockets
from ai_module import detect_and_pack  # AI 담당이 만든 모듈

async def ws_handler(ws, path):
    async for frame in detect_and_pack():
        # 프레임을 JPEG로 인코딩 후 전송
        _, jpeg = cv2.imencode('.jpg', frame)
        await ws.send(jpeg.tobytes())

start_server = websockets.serve(ws_handler, "0.0.0.0", 8000)
asyncio.get_event_loop().run_until_complete(start_server)
asyncio.get_event_loop().run_forever()
```

### 🌐 Web(Vue) 수신

```js
const ws = new WebSocket("ws://localhost:8000");
ws.binaryType = "arraybuffer";

ws.onmessage = (msg) => {
  const blob = new Blob([msg.data], { type: "image/jpeg" });
  const url = URL.createObjectURL(blob);
  document.getElementById("cam").src = url;
};
```

> **역할 분리:**  
> - AI: `detect_fire`, `detect_and_pack()` 같은 **모델/추론 모듈 제공**  
> - BE: **WebSocket 서버 + 연결 관리 + 예외 처리** 담당

---

## 3. 화재 이벤트 처리 흐름

### ✔ 전체 흐름

1. AI 감지 서버가 화재를 탐지  
2. AI 모듈에서 BE REST API 호출  
   - `POST /api/fire-events`  
3. BE가 MySQL에 이벤트 저장 (`fire_events`)  
4. FE(Vue)에서  
   - `/api/fire-events` (로그 목록)  
   - `/api/stats/fire-events` (통계) 조회  
5. FE 대시보드에서  
   - 팝업/배너 알림  
   - 로그 테이블  
   - 통계 차트 표시  

### ✅ DB 스키마 예시

#### `cameras` 테이블

```sql
CREATE TABLE cameras (
    id INT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(50),
    rtsp_url VARCHAR(255),
    location VARCHAR(100),
    enabled TINYINT(1) DEFAULT 1,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP
);
```

#### `fire_events` 테이블

```sql
CREATE TABLE fire_events (
    id INT AUTO_INCREMENT PRIMARY KEY,
    camera_id INT NOT NULL,
    level ENUM('LOW','MID','HIGH') NOT NULL,
    message VARCHAR(255) NOT NULL,
    detected_at DATETIME NOT NULL,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (camera_id) REFERENCES cameras(id)
);
```

---

## 4. 정규화 / N:M 관계 / 2NF 요약

### ✔ N:M 관계 핵심

- RDB(MySQL)에서 **N:M은 직접 표현 불가**
- **교차 테이블**을 만들어 1:N + 1:N 구조로 분해해야 함

### ✔ 2NF 위반 예시

```text
order_id | product_id | user_id | product_name | product_price
```

- `user_id` → `order_id`에만 종속  
- `product_name`, `product_price` → `product_id`에만 종속  

⇒ 복합키 일부에만 종속되는 **부분 함수 종속** → **2NF 위반**

### ✔ 올바른 구조 예시

**Order**

- id  
- user_id  
- created_at  

**Product**

- id  
- name  
- price  

**OrderProducts (교차 테이블)**

- order_id (PK, FK)  
- product_id (PK, FK)  
- quantity  
- price (주문 당시 스냅샷)  

---

## 5. 비밀번호 해싱(Argon2) 요약

- 해시는 **복호화 불가능한 일방향 변환**  
- 비밀번호는 **절대 평문 저장 금지** ❌  
- Argon2 해시 문자열 길이: 보통 **90~120자**  
- MySQL 컬럼 타입은 넉넉하게 `VARCHAR(255)` 사용 추천  

---

## 6. 역할별 + FE 분담 상세 정리 (균형 조정 버전)

> AI가 **데이터 + 학습까지** 맡는 만큼,  
> BE/DB는 **실시간 파이프라인, 로그/차트, 관리/권한/대시보드**를 더 책임지는 구조로 균형을 맞춤.

---

### 👤 1) AI 담당 + FE(실시간 감지 로직/표시 협업)

#### 🔹 AI 담당 주요 업무

**1) 데이터 관련**

- 화재/비화재 영상 데이터 수집  
  - 공개 데이터셋 + 직접 촬영 등  
- 라벨링 기준 정의  
  - 불꽃 / 연기 / 배경 / 오탐 구분 등  
- 라벨링 툴(예: LabelMe) 구조 설계  
  - 팀원들이 동일 기준으로 작업할 수 있게 예시 제공  
- 팀원 라벨링 결과 검수  

**2) 모델 관련**

- 화재 감지 모델 선택 (예: YOLO 계열)  
- 학습 스크립트 작성, 하이퍼파라미터 튜닝  
- 검증/테스트 및 베스트 weight 선정  
- 추론 속도/정확도 밸런스 조정  

**3) 추론 모듈화**

- RTSP/웹캠 프레임 입력 → 감지 결과(박스 좌표, 라벨, score) 반환하는 함수/모듈 작성  
  - 예: `detect_fire(frame) -> (results, fire_detected, meta)`  
- 프레임 위에 바운딩 박스, `"FIRE"` 라벨 오버레이 기능 구현  
- 감지 여부/레벨에 따라 BE REST API 호출  
  - `POST /api/fire-events`  

#### 🔹 AI 담당이 맡을 FE/UX 협업 파트 (실시간 화면 관점)

- “위험 / 주의 / 정상” 기준 정의 (LOW/MID/HIGH)  
- 박스 색상, 라벨 텍스트 등 감지 결과 표현 방식 정의  
- BE 실시간 화면에서 **어떤 데이터가 필요할지(레벨, score, 클래스명 등)** 정리해서 공유  

> ✅ **한 줄 요약:**  
> “AI 담당은 **데이터·모델·추론 + 감지 로직 설계**를 책임지고,  
> FE/BE가 화면에 잘 표시할 수 있게 필요한 정보와 기준을 정의해준다.”

---

### 👤 2) BE 담당(당신) + FE(실시간 레이아웃/로그/대시보드/알림)

#### 🔹 BE 담당 주요 업무

**1) WebSocket & 실시간 파이프라인**

- AI 모듈(`detect_and_pack`)을 호출하는 WebSocket 서버 구현  
- 클라이언트 연결/해제, 예외 처리  
- 프레임 + (선택) 메타데이터 전달 규약 정의  
  - 예: 바이너리 프레임 + 별도 REST로 메타데이터,  
    또는 JSON + 이미지 등 구조 협의  

**2) API 설계/구현**

- `POST /api/fire-events` : AI 서버에서 이벤트 수신  
- `GET /api/fire-events` : 로그 리스트 + 필터(날짜/카메라/레벨)  
- `GET /api/stats/fire-events` : 통계 API(일자별/카메라별/레벨별)  
- `GET /api/cameras` : 카메라 목록 조회  
- (선택) `POST /api/cameras`, `PUT /api/cameras/{id}`, `DELETE /api/cameras/{id}`  

**3) 서비스/도메인 로직**

- 감지 레벨(LOW/MID/HIGH) 기준을 AI와 협의 후 코드에 반영  
- 알림 발생 조건 정의  
  - 예: HIGH → 팝업 + 카카오 알림,  
        MID 이상 → 로그 기록,  
        LOW → 통계에만 반영 등  

**4) 인프라/배포**

- Docker 기반 BE 실행환경(Dockerfile, docker-compose 일부) 구성  
- `.env` 기본 설정 관리 (DB 주소, 포트, 토큰 등)  

#### 🔹 BE 담당이 맡을 FE 파트

**1) 실시간 모니터링 화면 (레이아웃 중심)**

- WebSocket 연결/해제 버튼 + 상태 표시  
- `<img id="cam">` 영역과 주변 정보 영역 구성  
- AI가 넘겨주는 감지 레벨/메시지/카메라 정보 표시  

**2) 로그/이벤트 탭**

- `fire_events` 테이블 기반 리스트 UI  
- 날짜/카메라/레벨 필터, 페이징  

**3) 대시보드/차트 탭**

- 일자별 화재 건수 그래프  
- 카메라별/위치별 통계 그래프  

**4) 알림 UI**

- HIGH 이벤트 발생 시 상단 경고 배너  
- 우측 슬라이드 알림 목록(최근 N건)  

> ✅ **한 줄 요약:**  
> “BE 담당은 **실시간 화면의 뼈대 + 로그/통계/알림 FE**를 주도하고,  
> AI 모듈을 붙여서 완성된 서비스 형태로 만드는 역할.”

---

### 👤 3) DB 담당 + FE(카메라/권한 관리 + 관리자 대시보드 일부)

#### 🔹 DB 담당 주요 업무

**1) 전체 ERD 설계 보조**

- `cameras`, `fire_events`, `users`, `roles`, `user_roles` 등 도메인 구조 확정  
- 정규화(2NF, 3NF) 검토  

**2) MySQL 테이블 상세 설계 + DDL 작성**

- PK/FK, 인덱스 구성  
- 조회 패턴에 맞춘 인덱스 튜닝  
  - 예: `fire_events(camera_id, detected_at)`  

**3) 샘플/시드 데이터 생성**

- 데모/테스트용 카메라, 사용자, 이벤트 데이터  

**4) 운영/성능 관점**

- 오래된 `fire_events` 아카이빙/백업 전략 제안  
- 관리자 대시보드에 필요한 집계 쿼리 설계  

#### 🔹 DB 담당이 맡을 FE 파트

**1) 카메라 관리 UI**

- 카메라 목록/추가/수정/삭제 화면  
- 필드: 이름, RTSP URL, 위치, 사용 여부(enabled) 등  

**2) 사용자/권한 관리 화면**

- 사용자 목록/추가/비활성화  
- 역할(관리자/관제요원 등) 설정  

**3) 관리자용 요약 대시보드 일부**

- 전체 카메라 수, 활성/비활성 카메라 수  
- 최근 N건 이벤트 간단 목록 카드  

> ✅ **한 줄 요약:**  
> “DB 담당은 **스키마·성능 + 카메라/사용자/권한 관리 화면 + 관리자 대시보드 기초**를 책임진다.”

---

### ## 2. 팀 전체 FE 분담 규칙 요약 (조정 후)

- FE는 **한 명이 전부**가 아니라,  
  **각 도메인(AI/BE/DB)에 맞는 화면을 함께 맡되, 최종 책임자는 명확히 정하는 구조.**

- **AI**  
  - 데이터/모델/추론  
  - 감지 결과/레벨 설계  
  - 실시간 감지 표현 논리  

- **BE**  
  - WebSocket/실시간 레이아웃  
  - 로그/통계/알림 화면  

- **DB**  
  - 카메라/사용자/권한 관리  
  - 관리자 요약 대시보드  

---

## 7. FE 분담 최종 표

| FE 화면                                  | 담당 | 비고                                      |
|------------------------------------------|------|-------------------------------------------|
| 실시간 모니터링 화면 (레이아웃/연결)     | BE   | WebSocket 연결, 레이아웃/상태 표시        |
| 실시간 감지 표현 (박스/상태 로직 설계)   | AI   | 모델 결과에 맞는 레벨/표현 방식 정의      |
| 로그/이벤트 화면                         | BE   | `fire_events` 리스트 + 필터               |
| 통계/차트                                | BE   | 일자별/카메라별 그래프                    |
| 알림 시스템 UI                           | BE   | 상단 배너, 우측 사이드 알림              |
| 카메라 관리 화면                         | DB   | 카메라 CRUD + enabled 설정                |
| 사용자/권한 관리 화면                    | DB   | `users / roles / user_roles`             |
| 관리자 요약 대시보드 (카메라/이벤트 카드)| DB   | 전체 카메라 수, 최근 이벤트 카드 등      |

---

## ✅ 전체 요약

- **AI:** 데이터 수집·라벨링·학습·추론 모듈 + 감지 레벨/표현 기준 설계  
- **BE:** WebSocket/실시간 화면 뼈대 + 로그·통계·알림 FE + API/배포  
- **DB:** 스키마/성능 + 카메라/사용자/권한 관리 + 관리자 대시보드 기초  

3명이 **본인 도메인 + 일부 FE**를 맡아,  
업무량과 책임 범위를 최대한 균형 있게 나눈 구조입니다.
