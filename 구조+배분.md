# 🔥 CCTV 화재 감지 프로젝트 전체 기술 정리 + 역할 분담 (MD 버전)

---

# 1. 프로젝트 전체 흐름 구조

## 🔧 시스템 아키텍처 개요

```
[IP CCTV / 웹캠]
        ↓ (RTSP / 장치)
[Python AI 서버]  ← AI 담당 (+ FE 실시간 화면)
 - OpenCV 캡처
 - 화재 감지 모델 적용
 - 감지 박스 그리기
 - WebSocket으로 프레임 송출
 - 화재 시 BE로 이벤트 REST 전송

        ↓ (REST)
[백엔드 API 서버]  ← BE 담당 (+ FE 대시보드/로그/알림)
 - 이벤트 수신
 - DB 저장
 - 로그/통계 API 제공

        ↓ (SQL)
[DB(MySQL)]        ← DB 담당 (+ FE 설정/관리 화면)
 - cameras
 - fire_events
 - users 등

        ↑
        └────[프론트엔드(Vue)]────┘  ← FE는 3명 분담
```

---

# 2. 실시간 영상(WebSocket) 스트리밍 구조

## ✔ Python → WebSocket → 브라우저

### Python(WebSocket 서버)

```python
import cv2, asyncio, websockets
import aiohttp

RTSP_URL = "rtsp://user:pass@192.168.0.50:554/stream"

async def report_event():
    async with aiohttp.ClientSession() as s:
        await s.post("http://backend:8080/api/fire-events",
                     json={"camera_id":1,"level":"HIGH","message":"화재 감지"})

async def send_frames(ws, path):
    cap = cv2.VideoCapture(RTSP_URL)
    while True:
        ret, frame = cap.read()
        if not ret:
            continue

        # AI 감지 (생략) + 박스 그리기
        # results, fire_detected = detect_fire(frame)

        _, jpeg = cv2.imencode('.jpg', frame)
        await ws.send(jpeg.tobytes())

        # if fire_detected:
        #     asyncio.create_task(report_event())

start_server = websockets.serve(send_frames, "0.0.0.0", 8000)
asyncio.get_event_loop().run_until_complete(start_server)
asyncio.get_event_loop().run_forever()
```

### Web(Vue) 수신

```js
const ws = new WebSocket("ws://localhost:8000");
ws.binaryType = "arraybuffer";

ws.onmessage = (msg) => {
  const blob = new Blob([msg.data], { type: "image/jpeg" });
  const url = URL.createObjectURL(blob);
  document.getElementById("cam").src = url;
};
```

---

# 3. 화재 이벤트 처리 흐름

## ✔ 전체 흐름

1. AI 감지 서버가 화재를 탐지  
2. BE REST API 호출 (`POST /api/fire-events`)  
3. BE가 MySQL에 저장  
4. FE에서 `/api/fire-events` 조회  
5. FE 대시보드에서 이벤트 팝업/로그/차트 표시  

## ✔ DB 스키마 예시

### cameras

```sql
CREATE TABLE cameras (
    id INT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(50),
    rtsp_url VARCHAR(255),
    location VARCHAR(100),
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP
);
```

### fire_events

```sql
CREATE TABLE fire_events (
    id INT AUTO_INCREMENT PRIMARY KEY,
    camera_id INT NOT NULL,
    level ENUM('LOW','MID','HIGH') NOT NULL,
    message VARCHAR(255) NOT NULL,
    detected_at DATETIME NOT NULL,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (camera_id) REFERENCES cameras(id)
);
```

---

# 4. 정규화 / N:M 관계 / 2NF 요약

## ✔ N:M 관계 핵심

MySQL에서 N:M 관계는 **직접 표현 불가**  
→ 반드시 **교차테이블**로 1:N + 1:N 구조로 분해해야 함.

## ✔ 2NF 위반 예시

| order_id | product_id | user_id | product_name | product_price |
|---------|------------|---------|--------------|---------------|

- `user_id` → `order_id`에만 종속  
- `product_name`, `product_price` → `product_id`에만 종속  
→ 복합키 일부에만 종속되는 **부분 함수 종속 → 2NF 위반**

## ✔ 올바른 구조

### Order
- id  
- user_id  
- created_at  

### Product
- id  
- name  
- price  

### OrderProducts (교차 테이블)
- order_id (PK, FK)  
- product_id (PK, FK)  
- quantity  
- price(주문 당시 스냅샷)

---

# 5. 비밀번호 해싱(Argon2) 요약

- 해시는 복호화 불가능한 일방향 변환  
- 비밀번호는 절대 평문 저장 ❌  
- Argon2 문자열 길이: **90~120자**, MySQL은 `VARCHAR(255)` 권장

---

# 6. 역할별 + FE 분담 상세 정리

------------------------------------------------------------------------

# 👤 1) AI 담당 + FE(실시간 모니터링 화면)

## 🔹 AI 담당 주요 업무

-   IP CCTV / 웹캠에서 영상 가져오기
    -   `cv2.VideoCapture(RTSP_URL 또는 0)` 사용\
-   화재 감지 모델(예: YOLO) 탑재 및 추론 코드 작성\
-   프레임 위에 바운딩박스, 라벨("FIRE") 오버레이\
-   WebSocket 서버 구현
    -   JPEG 바이너리로 계속 전송\
    -   여러 클라이언트 연결 고려\
-   화재 발생 시 BE 서버로 REST 호출
    -   `POST /api/fire-events`

## 🔹 AI 담당이 맡을 FE 파트 (실시간 화면)

-   "실시간 모니터링" 페이지 구현 (Vue)
    -   WebSocket 연결
    -   CCTV 화면 + 감지박스 표시
-   화면 내 상태 표시
    -   카메라 이름, 위치, 연결 상태(ON/OFF)
-   감지 시 시각적 강조 UI
    -   화면 테두리 빨간색 점멸
    -   "🔥 FIRE DETECTED" 경고 텍스트

## ➤ 한 줄 요약

**"실시간 CCTV + 화재 박스 표시 FE는 AI 담당이 끝까지 책임진다."**

------------------------------------------------------------------------

# 👤 2) BE 담당(당신) + FE(로그/대시보드/알림)

## 🔹 BE 담당 주요 업무

-   전체 API 설계
    -   `POST /api/fire-events` : AI 서버에서 이벤트 수신
    -   `GET /api/fire-events` : 로그 리스트 + 필터
    -   `GET /api/stats/fire-events` : 통계 API(일자별/카메라별)
    -   `GET /api/cameras` : 카메라 목록 조회 API
    -   (선택) `POST /api/cameras` : 카메라 추가
-   서비스/도메인 로직
    -   감지 레벨(LOW/MID/HIGH) 기준 정의
    -   알림 조건 설정
-   예외 처리, 인증/인가(필요 시)
-   Docker 기반 BE 배포 환경 구성

## 🔹 BE 담당이 맡을 FE 파트 (로그 & 대시보드 & 알림)

-   "로그/이벤트 탭" 구현
    -   fire_events 테이블 기반 목록 표시
    -   날짜/카메라/레벨 필터 UI
-   "대시보드/차트 탭" 구현
    -   일자별 화재 건수 그래프
    -   카메라별/위치별 통계 시각화
-   알림 UI
    -   HIGH 이벤트 발생 시 화면 상단 배너
    -   우측 사이드 알림 목록
-   API 연동 예제 코드 제공
    -   FE 팀원들이 쉽게 호출할 수 있도록 가이드 작성

## ➤ 한 줄 요약

**"데이터·로그·통계·알림 화면은 BE 담당(너)이 FE까지 책임진다."**

------------------------------------------------------------------------

# 👤 3) DB 담당 + FE(관리/설정 화면)

## 🔹 DB 담당 주요 업무

-   전체 ERD 설계 보조
    -   cameras / fire_events / users / roles 등 도메인 구조 확정\
-   MySQL 테이블 상세 설계 + DDL 작성
    -   PK/FK, 인덱스 구성\
    -   2NF / 3NF 정규화 검토\
-   샘플 데이터 / 시드 데이터 생성\
-   fire_events 성능 튜닝
    -   날짜/카메라 기반 조회 인덱스 최적화

## 🔹 DB 담당이 맡을 FE 파트 (관리/설정 화면)

-   카메라 관리 UI (카메라 목록/추가/수정/삭제)
-   카메라 정보 표시
    -   이름, RTSP URL, 위치, 사용 여부
-   사용자/권한 관리 화면(선택)
-   스키마에 맞는 폼 검증 로직 작성

## ➤ 한 줄 요약

**"카메라 관리·설정·기초 데이터 FE는 DB 담당이 맡는다."**

------------------------------------------------------------------------

# \## 2. 팀 전체 FE 분담 규칙 요약

FE는 "한 명이 전부"가 아니라,\
**각자 맡은 도메인(AI/BE/DB)에 맞는 FE 화면을 같이 맡는 구조.**

  영역          담당      FE 책임 화면
  ------------- --------- -----------------------------------------
  **AI**        AI 담당   실시간 모니터링 화면 (CCTV + 박스 표시)
  **BE (너)**   BE 담당   로그/대시보드/알림 UI
  **DB**        DB 담당   카메라 관리 / 설정 / 관리자 화면

------------------------------------------------------------------------

# 7. FE 분담 최종 표

| FE 화면                | 담당 |
|------------------------|-------|
| 실시간 모니터링 화면   | AI   |
| 로그/이벤트 화면        | BE   |
| 통계/차트              | BE   |
| 알림 시스템             | BE   |
| 카메라 관리            | DB   |
| 설정/관리자 페이지      | DB   |

---